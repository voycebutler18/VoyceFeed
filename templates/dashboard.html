<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Snayvu – The Super Platform</title>
    <style>
        /* General Styles */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'SF Pro Display', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #0a0a0a;
            color: white;
            overflow-x: hidden;
            line-height: 1.6;
        }

        /* Header */
        .header {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            background: rgba(10, 10, 10, 0.95);
            backdrop-filter: blur(20px);
            z-index: 1000;
            padding: 15px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .header-content {
            max-width: 600px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .logo {
            font-size: 1.8rem; /* Slightly larger for emphasis */
            font-weight: 800; /* Bolder */
            background: linear-gradient(45deg, #a855f7, #6366f1); /* Snayvu brand gradient */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            cursor: pointer;
            text-shadow: 0 0 15px rgba(168, 85, 247, 0.4); /* Glow effect */
        }

        .user-menu {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info-group {
            display: flex;
            flex-direction: column;
            align-items: flex-end;
            gap: 5px;
        }

        .user-email {
            font-size: 0.9rem;
            opacity: 0.7;
        }

        .streak-tracker {
            display: inline-flex;
            align-items: center;
            background: rgba(255, 215, 0, 0.2);
            border: 1px solid rgba(255, 215, 0, 0.4);
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: 600;
            color: #ffd700;
            box-shadow: 0 2px 5px rgba(255, 215, 0, 0.1);
            transition: all 0.2s ease;
        }
        .streak-tracker:hover {
            transform: translateY(-1px);
            box-shadow: 0 3px 8px rgba(255, 215, 0, 0.2);
        }
        .streak-icon {
            margin-right: 5px;
            font-size: 1em;
        }

        .logout-btn {
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        .logout-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        /* Main Content */
        .main-content {
            margin-top: 80px;
            padding: 20px;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
        }

        .welcome-section {
            text-align: center;
            margin-bottom: 40px;
            padding: 30px 20px;
            background: linear-gradient(135deg, rgba(99, 102, 241, 0.1), rgba(168, 85, 247, 0.1)); /* Snayvu gradient with transparency */
            border-radius: 20px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .welcome-title {
            font-size: 2rem;
            font-weight: 700;
            margin-bottom: 10px;
            background: linear-gradient(45deg, #6366f1, #a855f7); /* Snayvu gradient */
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .welcome-subtitle {
            font-size: 1.1rem;
            opacity: 0.8;
            line-height: 1.5;
        }

        /* General Dashboard Section Styling */
        .dashboard-section {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            padding: 20px;
            margin-bottom: 30px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
        }

        .section-header {
            font-size: 1.2rem;
            font-weight: 600;
            margin-bottom: 20px;
            color: #a855f7; /* Snayvu accent color */
            text-align: center;
        }

        .section-content {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .story-item {
            display: flex;
            align-items: center;
            gap: 15px;
            background: rgba(255, 255, 255, 0.03);
            padding: 10px 15px;
            border-radius: 12px;
            cursor: pointer;
            transition: background 0.2s ease, transform 0.2s ease;
        }
        .story-item:hover {
            background: rgba(255, 255, 255, 0.07);
            transform: translateY(-2px);
        }
        .story-thumbnail {
            width: 80px;
            height: 45px;
            border-radius: 8px;
            overflow: hidden;
            flex-shrink: 0;
        }
        .story-thumbnail img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .story-details {
            flex-grow: 1;
        }
        .story-title {
            font-size: 1rem;
            font-weight: 500;
            margin-bottom: 5px;
            line-height: 1.3;
        }
        .story-meta {
            font-size: 0.8rem;
            opacity: 0.7;
        }
        .story-genre-tag {
            background: rgba(99, 102, 241, 0.2); /* Matching Snayvu accent */
            color: #6366f1;
            padding: 3px 8px;
            border-radius: 5px;
            font-size: 0.75em;
            margin-left: 5px;
        }

        /* Video Feed (General Stream) */
        .video-feed {
            display: flex;
            flex-direction: column;
            gap: 30px;
        }

        .video-card {
            background: rgba(255, 255, 255, 0.05);
            border-radius: 20px;
            overflow: hidden;
            border: 1px solid rgba(255, 255, 255, 0.1);
            transition: all 0.3s ease;
        }
        .video-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
            border-color: rgba(255, 255, 255, 0.2);
        }

        .video-container {
            position: relative;
            width: 100%;
            height: 0;
            padding-bottom: 56.25%; /* 16:9 aspect ratio */
            background: #000;
        }
        .video-container iframe {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            border: none;
        }

        .video-info {
            padding: 20px;
        }

        .video-title {
            font-size: 1.3rem;
            font-weight: 600;
            margin-bottom: 10px;
            line-height: 1.4;
        }

        .video-description {
            font-size: 1rem;
            opacity: 0.8;
            line-height: 1.6;
            margin-bottom: 15px;
        }

        .video-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.9rem;
            opacity: 0.6;
            margin-bottom: 20px;
        }

        .video-date {
            font-weight: 500;
        }

        .video-duration {
            background: rgba(255, 255, 255, 0.1);
            padding: 4px 8px;
            border-radius: 6px;
            font-size: 0.8rem;
        }

        /* Video Actions */
        .video-actions {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-bottom: 20px;
            padding: 15px 0;
            border-top: 1px solid rgba(255, 255, 255, 0.1);
        }

        .action-btn {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 16px;
            border-radius: 10px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
            text-decoration: none;
        }

        .action-btn:hover {
            background: rgba(255, 255, 255, 0.2);
            transform: translateY(-1px);
        }

        .action-btn.liked {
            background: rgba(168, 85, 247, 0.2); /* Snayvu accent for liked state */
            color: #a855f7;
            border-color: rgba(168, 85, 247, 0.3);
        }
        .action-btn.liked:hover {
            background: rgba(168, 85, 247, 0.3);
        }

        .share-menu {
            position: relative;
            display: inline-block;
        }

        .share-dropdown {
            display: none;
            position: absolute;
            bottom: 100%; /* Position above button */
            left: 50%;
            transform: translateX(-50%);
            background: rgba(25, 25, 25, 0.95); /* Darker background for dropdown */
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.5);
            padding: 10px 0;
            min-width: 200px;
            z-index: 10;
            animation: fadeIn 0.2s ease-out;
        }
        .share-dropdown.active {
            display: block;
        }

        .share-option {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 12px 16px;
            color: white;
            text-decoration: none;
            transition: all 0.2s ease;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .share-option:last-child {
            border-bottom: none;
        }
        .share-option:hover {
            background: rgba(255, 255, 255, 0.1);
        }
        .share-icon {
            font-size: 1.2rem;
        }

        /* Behind the Story */
        .behind-the-story-toggle {
            display: block;
            width: fit-content;
            margin: 0 auto 15px;
            padding: 8px 15px;
            background: rgba(99, 102, 241, 0.2);
            border: 1px solid rgba(99, 102, 241, 0.4);
            border-radius: 8px;
            color: #6366f1;
            font-size: 0.9rem;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .behind-the-story-toggle:hover {
            background: rgba(99, 102, 241, 0.3);
            transform: translateY(-1px);
        }
        .behind-the-story-content {
            background: rgba(255, 255, 255, 0.02);
            border-radius: 12px;
            padding: 15px;
            margin-top: 15px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            display: none;
            animation: fadeIn 0.3s ease-out;
        }
        .behind-the-story-content p {
            font-size: 0.95rem;
            line-height: 1.6;
            opacity: 0.8;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* Comments System */
        .comments-section {
            border-top: 1px solid rgba(255, 255, 255, 0.1);
            padding-top: 20px;
        }

        .comments-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .comments-count {
            font-size: 1.1rem;
            font-weight: 600;
            color: #a855f7; /* Snayvu accent for comments */
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .comments-count:hover {
            opacity: 1;
            transform: translateY(-1px);
        }

        .comments-toggle {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        .comments-toggle:hover {
            background: rgba(255, 255, 255, 0.1);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .comment-form {
            display: flex;
            gap: 12px;
            margin-bottom: 25px;
            align-items: flex-start;
        }

        .comment-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #6366f1, #a855f7); /* Snayvu gradient */
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.1rem;
            flex-shrink: 0;
        }

        .comment-input-container {
            flex: 1;
            position: relative;
        }

        .comment-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 12px 16px;
            border-radius: 12px;
            font-size: 0.95rem;
            line-height: 1.4;
            resize: vertical;
            min-height: 44px;
            transition: all 0.3s ease;
        }
        .comment-input:focus {
            outline: none;
            border-color: #a855f7; /* Snayvu accent color */
            background: rgba(255, 255, 255, 0.15);
        }
        .comment-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        .comment-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 10px;
        }

        .comment-btn {
            background: #a855f7; /* Snayvu accent color */
            border: none;
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        .comment-btn:hover {
            background: #9333ea; /* Darker Snayvu accent */
            transform: translateY(-1px);
        }
        .comment-btn:disabled {
            background: rgba(255, 255, 255, 0.1);
            cursor: not-allowed;
            transform: none;
        }

        .cancel-btn {
            background: transparent;
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 8px 16px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }
        .cancel-btn:hover {
            background: rgba(255, 255, 255, 0.1);
        }

        .comments-list {
            display: flex;
            flex-direction: column;
            gap: 20px;
        }

        .comment {
            display: flex;
            gap: 12px;
            padding: 15px;
            background: rgba(255, 255, 255, 0.03);
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.05);
            transition: all 0.3s ease;
        }
        .comment:hover {
            background: rgba(255, 255, 255, 0.05);
            border-color: rgba(255, 255, 255, 0.1);
        }

        .comment-content {
            flex: 1;
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 8px;
        }

        .comment-author {
            font-weight: 600;
            color: #a855f7; /* Snayvu accent color */
            font-size: 0.95rem;
        }

        .comment-time {
            font-size: 0.85rem;
            opacity: 0.6;
        }

        .comment-text {
            font-size: 0.95rem;
            line-height: 1.5;
            margin-bottom: 12px;
            word-wrap: break-word;
        }

        .comment-footer {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .comment-like-btn, .comment-reply-btn {
            display: flex;
            align-items: center;
            gap: 6px;
            background: transparent;
            border: none;
            color: rgba(255, 255, 255, 0.6);
            cursor: pointer;
            font-size: 0.85rem;
            padding: 6px 12px;
            border-radius: 6px;
            transition: all 0.3s ease;
        }
        .comment-like-btn:hover, .comment-reply-btn:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }
        .comment-like-btn.liked {
            color: #a855f7; /* Snayvu accent color */
        }
        .comment-like-btn.liked:hover {
            color: #9333ea; /* Darker Snayvu accent */
        }

        .replies {
            margin-left: 52px;
            margin-top: 15px;
            padding-left: 20px;
            border-left: 2px solid rgba(255, 255, 255, 0.1);
        }

        .reply {
            margin-bottom: 15px;
            padding: 12px;
            background: rgba(255, 255, 255, 0.02);
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .reply-form {
            margin-top: 15px;
            margin-left: 52px;
        }

        .reply-input {
            width: 100%;
            background: rgba(255, 255, 255, 0.1);
            border: 1px solid rgba(255, 255, 255, 0.2);
            color: white;
            padding: 10px 14px;
            border-radius: 8px;
            font-size: 0.9rem;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        .reply-input:focus {
            outline: none;
            border-color: #a855f7; /* Snayvu accent color */
            background: rgba(255, 255, 255, 0.15);
        }
        .reply-input::placeholder {
            color: rgba(255, 255, 255, 0.5);
        }

        /* Loading/Empty/Error States */
        .loading, .empty-state {
            text-align: center;
            padding: 60px 20px;
            opacity: 0.7;
        }
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 3px solid rgba(255, 255, 255, 0.1);
            border-top: 3px solid #a855f7; /* Snayvu accent color */
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .loading-text {
            font-size: 1.1rem;
        }
        .empty-icon {
            font-size: 4rem;
            margin-bottom: 20px;
        }
        .empty-title {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 10px;
        }
        .empty-subtitle {
            font-size: 1rem;
        }
        .error-message {
            background: rgba(255, 107, 107, 0.1);
            border: 1px solid rgba(255, 107, 107, 0.3);
            color: #ff6b6b;
            padding: 15px 20px;
            border-radius: 12px;
            margin: 20px 0;
            text-align: center;
        }
        .comments-empty {
            text-align: center;
            padding: 30px 20px;
            opacity: 0.6;
        }
        .comments-empty-icon {
            font-size: 2.5rem;
            margin-bottom: 15px;
        }
        .comments-empty-text {
            font-size: 1rem;
            margin-bottom: 5px;
        }
        .comments-empty-subtitle {
            font-size: 0.9rem;
            opacity: 0.8;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .header-content {
                padding: 0 10px;
            }
            .user-email {
                display: none;
            }
            .main-content {
                padding: 15px;
                margin-top: 70px;
            }
            .welcome-section {
                margin-bottom: 30px;
                padding: 20px 15px;
            }
            .welcome-title {
                font-size: 1.5rem;
            }
            .welcome-subtitle {
                font-size: 1rem;
            }
            .video-info {
                padding: 15px;
            }
            .video-title {
                font-size: 1.2rem;
            }
            .video-description {
                font-size: 0.9rem;
            }
            .video-meta {
                font-size: 0.8rem;
            }
            .video-actions {
                flex-wrap: wrap;
                gap: 10px;
                align-items: flex-start;
            }
            .action-btn {
                flex: 1;
                min-width: 100px;
                justify-content: center;
            }
            .comment-avatar {
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
            .comment-input {
                font-size: 0.9rem;
                padding: 10px 14px;
            }
            .comment-text {
                font-size: 0.9rem;
            }
            .replies {
                margin-left: 35px;
                padding-left: 15px;
            }
            .reply-form {
                margin-left: 35px;
            }
            .comments-header {
                flex-direction: column;
                gap: 15px;
                align-items: flex-start;
            }
            .comment-footer {
                gap: 10px;
            }
            .comment-like-btn, .comment-reply-btn {
                padding: 4px 8px;
                font-size: 0.8rem;
            }
        }

        /* Modals */
        .modal {
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.8);
            backdrop-filter: blur(5px);
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background: #0a0a0a;
            margin: auto;
            padding: 30px;
            border-radius: 20px;
            width: 90%;
            max-width: 600px;
            border: 1px solid rgba(255, 255, 255, 0.1);
            max-height: 80vh;
            overflow-y: auto;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        .modal-title {
            font-size: 1.5rem;
            font-weight: 600;
        }
        .close-btn {
            background: none;
            border: none;
            color: white;
            font-size: 1.5rem;
            cursor: pointer;
            opacity: 0.7;
            transition: opacity 0.3s ease;
        }
        .close-btn:hover {
            opacity: 1;
        }

        /* Likes and Comments Modal Content */
        .likes-content, .comments-content {
            max-height: 400px;
            overflow-y: auto;
        }
        .like-item, .comment-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 15px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            background: rgba(255, 255, 255, 0.05);
            margin-bottom: 10px;
            border-radius: 12px;
        }
        .like-item:last-child, .comment-item:last-child {
            border-bottom: none;
            margin-bottom: 0;
        }
        .user-info {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #6366f1, #a855f7); /* Snayvu gradient */
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 1.1rem;
        }
        .user-details {
            flex: 1;
        }
        .user-name {
            font-weight: 600;
            font-size: 1rem;
            margin-bottom: 3px;
        }
        .user-email {
            font-size: 0.85rem;
            opacity: 0.7;
        }
        .like-time, .comment-time {
            font-size: 0.8rem;
            opacity: 0.6;
        }
        .comment-text {
            margin-top: 10px;
            padding: 10px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 0.9rem;
            line-height: 1.4;
        }
        .comment-meta {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-top: 10px;
            font-size: 0.8rem;
            opacity: 0.7;
        }
        .comment-likes {
            display: flex;
            align-items: center;
            gap: 5px;
        }
        .delete-comment-btn {
            background: rgba(255, 107, 107, 0.2);
            border: 1px solid rgba(255, 107, 107, 0.3);
            color: #ff6b6b;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 0.8rem;
            transition: all 0.3s ease;
        }
        .delete-comment-btn:hover {
            background: rgba(255, 107, 107, 0.3);
            transform: translateY(-1px);
        }
        .empty-state-small {
            text-align: center;
            padding: 40px 20px;
            opacity: 0.6;
        }
        .empty-state-small .empty-icon {
            font-size: 2rem;
            margin-bottom: 15px;
        }
        .loading-small {
            text-align: center;
            padding: 40px 20px;
        }
        .loading-small .loading-spinner {
            width: 30px;
            height: 30px;
            margin: 0 auto 15px;
        }

        /* Floating Feedback Button */
        .feedback-button-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 999;
        }
        .feedback-button {
            background: linear-gradient(45deg, #4ade80, #22c55e);
            color: white;
            border: none;
            border-radius: 50%;
            width: 60px;
            height: 60px;
            font-size: 1.8rem;
            display: flex;
            align-items: center;
            justify-content: center;
            box-shadow: 0 4px 15px rgba(74, 222, 128, 0.4);
            cursor: pointer;
            transition: all 0.3s ease;
        }
        .feedback-button:hover {
            transform: translateY(-3px) scale(1.05);
            box-shadow: 0 6px 20px rgba(74, 222, 128, 0.6);
        }
        /* Feedback Modal */
        #feedback-modal .modal-content {
            max-width: 450px;
            padding: 30px;
        }
        #feedback-modal textarea {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid rgba(255, 255, 255, 0.2);
            background: rgba(255, 255, 255, 0.1);
            color: white;
            font-size: 1rem;
            min-height: 120px;
            resize: vertical;
            margin-bottom: 15px;
            font-family: 'SF Pro Display', sans-serif;
        }
        #feedback-modal textarea::placeholder {
            color: rgba(255, 255, 255, 0.6);
        }
        #feedback-modal button {
            width: 100%;
            padding: 12px;
            background: linear-gradient(45deg, #4ade80, #22c55e);
            border: none;
            border-radius: 8px;
            color: white;
            font-size: 1rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        #feedback-modal button:hover {
            background: linear-gradient(45deg, #22c55e, #4ade80);
            transform: translateY(-1px);
        }
        .feedback-success-message {
            color: #4ade80;
            margin-top: 15px;
            display: none;
            font-size: 0.9rem;
        }
        .feedback-error-message {
            color: #ff6b6b;
            margin-top: 15px;
            display: none;
            font-size: 0.9rem;
        }

        /* NEW SNVYU Specific Styles */
        .close-circle-tab {
            display: inline-block;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 10px;
            font-size: 0.9rem;
            font-weight: 500;
            color: rgba(255, 255, 255, 0.8);
            margin-top: 15px;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .close-circle-tab:hover {
            background: rgba(255, 255, 255, 0.1);
            color: white;
        }

        /* Placeholder for new UI elements */
        .feature-placeholder {
            background: rgba(99, 102, 241, 0.1);
            border: 1px dashed rgba(99, 102, 241, 0.4);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            opacity: 0.8;
            font-size: 0.9rem;
            margin-top: 20px;
            color: #6366f1;
        }
    </style>
</head>
<body>
    <input type="hidden" id="csrf_token" name="csrf_token" value="{{ csrf_token() }}">

    <div class="header">
        <div class="header-content">
            <div class="logo">Snayvu</div>
            <div class="user-menu">
                <div class="user-info-group">
                    <span class="user-email" id="user-email">Loading...</span>
                    <span class="streak-tracker" id="watch-streak"><span class="streak-icon">🔥</span> <span id="streak-count">0</span>-Day Streak</span>
                </div>
                <button class="logout-btn" onclick="logout()">Logout</button>
            </div>
        </div>
    </div>

    <div class="main-content">
        <div class="welcome-section">
            <div class="welcome-title">Welcome to Snayvu</div>
            <div class="welcome-subtitle">
                The super-platform for stories, streams, and shorts.<br>
                One app. All formats. Maximum freedom.
            </div>
            <div class="feature-placeholder">
                <p>💡 **Concept: If Netflix, TikTok, and YouTube had a baby, it’d be Snayvu.**</p>
                <p style="margin-top: 10px;">Future integrations for multi-view, emotional reactions, and more coming soon!</p>
            </div>
        </div>

        <div class="dashboard-section">
            <div class="section-header">🎥 Premium Series (Netflix-style)</div>
            <div class="section-content" id="premium-series-list">
                <div class="story-item placeholder">
                    <div class="story-thumbnail"><img src="https://placehold.co/80x45/1a1a1a/888?text=Loading" alt="Loading"></div>
                    <div class="story-details">
                        <div class="story-title">Loading Premium Series...</div>
                        <div class="story-meta">Watch streaks, "Continue Watching", and trailers.</div>
                    </div>
                </div>
                <div class="feature-placeholder">
                    <p>Track your binge-watching and discover new episodic content here.</p>
                </div>
            </div>
        </div>

        <div class="dashboard-section">
            <div class="section-header">⏱ Shorts Feed (TikTok-style)</div>
            <div class="section-content" id="shorts-feed-list">
                <div class="story-item placeholder">
                    <div class="story-thumbnail"><img src="https://placehold.co/80x45/1a1a1a/888?text=Loading" alt="Loading"></div>
                    <div class="story-details">
                        <div class="story-title">Discovering Viral Shorts...</div>
                        <div class="story-meta">Instant reactions & mood-based algorithm.</div>
                    </div>
                </div>
                <div class="feature-placeholder">
                    <p>Experience up to 90-second vertical videos. Look out for reaction clips and duets!</p>
                </div>
            </div>
        </div>

        <div class="dashboard-section">
            <div class="section-header">📺 Channels (YouTube-style)</div>
            <div class="section-content" id="channels-list">
                <div class="story-item placeholder">
                    <div class="story-thumbnail"><img src="https://placehold.co/80x45/1a1a1a/888?text=Loading" alt="Loading"></div>
                    <div class="story-details">
                        <div class="story-title">Exploring Creator Channels...</div>
                        <div class="story-meta">Long-form videos, live streams, and playlists.</div>
                    </div>
                </div>
                <div class="feature-placeholder">
                    <p>Dive deep into your favorite creators' worlds with their full content libraries and live events.</p>
                    <button class="close-circle-tab">Explore Close Circle</button> </div>
            </div>
        </div>

        <div class="dashboard-section">
            <div class="section-header">✨ Your Personalized Feed</div>
            <div class="video-feed" id="video-feed">
                <div class="loading" id="loading">
                    <div class="loading-spinner"></div>
                    <div class="loading-text">Loading your stories...</div>
                </div>
            </div>
        </div>
    </div>

    <div id="likes-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Video Likes</div>
                <button class="close-btn" onclick="closeLikesModal()">×</button>
            </div>
            <div class="likes-content" id="likes-content"></div>
        </div>
    </div>

    <div id="comments-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 800px;">
            <div class="modal-header">
                <div class="modal-title">Video Comments</div>
                <button class="close-btn" onclick="closeCommentsModal()">×</button>
            </div>
            <div class="comments-content" id="comments-content"></div>
        </div>
    </div>

    <div id="feedback-modal" class="modal" style="display: none;">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">Suggest a Story / Give Feedback</div>
                <button class="close-btn" onclick="closeFeedbackModal()">×</button>
            </div>
            <textarea id="feedback-text" placeholder="Share your ideas or tell us what you think!"></textarea>
            <button onclick="submitFeedback()">Send Feedback</button>
            <div id="feedback-message" class="feedback-success-message"></div>
        </div>
    </div>

    <div class="feedback-button-container">
        <button class="feedback-button" onclick="showFeedbackModal()">💡</button>
    </div>

    <script>
        const BASE_URL = window.location.origin;
        let videos = [];
        let currentUser = null;
        let videoLikes = {};
        let activeReplyForms = {};
        let currentUserName = 'User';

        document.addEventListener('DOMContentLoaded', function() {
            loadUserInfo();
            loadVideos();
            loadPremiumSeries(); // New function for Netflix-style content
            loadShortsFeed();    // New function for TikTok-style content
            loadChannels();      // New function for YouTube-style content
        });

        async function loadUserInfo() {
            try {
                const response = await fetch(`${BASE_URL}/api/auth/check`);
                const data = await response.json();
                if (data.success) {
                    currentUser = data.user;
                    document.getElementById('user-email').textContent = currentUser.email;
                    currentUserName = currentUser.email.split('@')[0];
                    updateDailyWatchStreak();
                } else {
                    window.location.href = `${BASE_URL}/`;
                }
            } catch (error) {
                console.error('Error loading user info:', error);
                window.location.href = `${BASE_URL}/`;
            }
        }

        async function loadVideos() {
            try {
                const response = await fetch(`${BASE_URL}/api/videos`);
                const data = await response.json();
                if (data.success) {
                    videos = data.videos;
                    displayVideos(videos);
                } else {
                    throw new Error(data.message || 'Failed to load videos');
                }
            } catch (error) {
                console.error('Error loading videos:', error);
                showError('Failed to load videos. Please check your connection.');
            }
        }

        function displayVideos(videosToShow) {
            const videoFeed = document.getElementById('video-feed');
            const loading = document.getElementById('loading');
            loading.style.display = 'none';

            if (videosToShow.length === 0) {
                videoFeed.innerHTML = `
                    <div class="empty-state">
                        <div class="empty-icon">🎬</div>
                        <div class="empty-title">No stories yet</div>
                        <div class="empty-subtitle">New content will appear here as it's added.</div>
                    </div>
                `;
                return;
            }

            videoFeed.innerHTML = '';
            videosToShow.forEach(video => {
                const videoCard = createVideoCard(video);
                videoFeed.appendChild(videoCard);
                const likeBtn = document.getElementById(`like-btn-${video.id}`);
                const likeCount = document.getElementById(`like-count-${video.id}`);
                if (video.user_liked) {
                    likeBtn.classList.add('liked');
                }
                likeCount.textContent = video.likes_count || 0;
            });
            videosToShow.forEach(video => {
                loadComments(video.id);
            });
        }

        function createVideoCard(video) {
            const card = document.createElement('div');
            card.className = 'video-card';
            const createdDate = new Date(video.created_at).toLocaleDateString('en-US', { year: 'numeric', month: 'long', day: 'numeric' });
            const youtubeEmbedUrl = `https://www.youtube.com/embed/${video.youtube_video_id}?rel=0&modestbranding=1&playsinline=1`;
            const youtubeShareUrl = `https://youtu.be/${video.youtube_video_id}`;
            const shareTitle = `${video.title} - Snayvu`;
            const shareText = `Check out this amazing content on Snayvu: ${video.title}`;

            // All content is free, so no overlay needed
            const videoPlayerHtml = `
                <iframe src="${youtubeEmbedUrl}"
                        title="${escapeHtml(video.title)}"
                        frameborder="0"
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share"
                        allowfullscreen
                        onload="updateDailyWatchStreak()"></iframe>
            `;

            const videoActionsHtml = `
                <div class="video-actions">
                    <button class="action-btn like-btn" id="like-btn-${video.id}" onclick="toggleVideoLike(${video.id})">
                        <span>❤️</span>
                        <span id="like-count-${video.id}">${video.likes_count || 0}</span>
                    </button>
                    <div class="share-menu">
                        <button class="action-btn" onclick="toggleShareMenu(${video.id})">
                            <span>🔗</span> Share
                        </button>
                        <div class="share-dropdown" id="share-menu-${video.id}">
                            <a href="https://www.facebook.com/sharer/sharer.php?u=${encodeURIComponent(youtubeShareUrl)}" target="_blank" class="share-option"><span class="share-icon">📘</span> Facebook</a>
                            <a href="https://twitter.com/intent/tweet?url=${encodeURIComponent(youtubeShareUrl)}&text=${encodeURIComponent(shareText)}" target="_blank" class="share-option"><span class="share-icon">🐦</span> Twitter</a>
                            <a href="https://www.linkedin.com/sharing/share-offsite/?url=${encodeURIComponent(youtubeShareUrl)}" target="_blank" class="share-option"><span class="share-icon">💼</span> LinkedIn</a>
                            <a href="https://wa.me/?text=${encodeURIComponent(shareText + ' ' + youtubeShareUrl)}" target="_blank" class="share-option"><span class="share-icon">💬</span> WhatsApp</a>
                            <a href="${youtubeShareUrl}" target="_blank" class="share-option"><span class="share-icon">📺</span> Watch on YouTube</a>
                            <a href="#" onclick="copyToClipboard('${youtubeShareUrl}', '${escapeHtml(video.title)}'); return false;" class="share-option"><span class="share-icon">📋</span> Copy Link</a>
                        </div>
                    </div>
                </div>
            `;

            const commentsSectionHtml = `
                <div class="comments-section">
                    <div class="comments-header">
                        <div class="comments-count" id="comment-count-${video.id}" onclick="viewVideoComments(${video.id})">0 comments</div>
                        <button class="comments-toggle" onclick="toggleComments(${video.id})">
                            <span id="toggle-text-${video.id}">Show Comments</span>
                        </button>
                    </div>
                    <div class="comments-container" id="comments-${video.id}" style="display: none;">
                        <div class="comment-form">
                            <div class="comment-avatar">${generateAvatar(currentUserName)}</div>
                            <div class="comment-input-container">
                                <textarea class="comment-input" id="comment-input-${video.id}" placeholder="Add a comment..." rows="1"></textarea>
                                <div class="comment-actions" id="comment-actions-${video.id}" style="display: none;">
                                    <button class="cancel-btn" onclick="cancelComment(${video.id})">Cancel</button>
                                    <button class="comment-btn" onclick="postComment(${video.id})">Post</button>
                                </div>
                            </div>
                        </div>
                        <div class="comments-list" id="comments-list-${video.id}"></div>
                    </div>
                </div>
            `;

            card.innerHTML = `
                <div class="video-container">${videoPlayerHtml}</div>
                <div class="video-info">
                    <div class="video-title">${escapeHtml(video.title)}</div>
                    ${video.description ? `<div class="video-description">${escapeHtml(video.description)}</div>` : ''}
                    <div class="video-meta">
                        <span class="video-date">${createdDate}</span>
                        <span class="video-duration">New</span>
                    </div>
                    ${video.description ? `
                        <button class="behind-the-story-toggle" onclick="toggleBehindTheStory(${video.id})">Behind the Story</button>
                        <div class="behind-the-story-content" id="behind-the-story-${video.id}">
                            <p>This story was inspired by [Creator's Insight for ${escapeHtml(video.title)}].</p>
                            <p>My goal was to [Explain Creative Goal].</p>
                        </div>
                    ` : ''}
                    ${videoActionsHtml}
                    ${commentsSectionHtml}
                </div>
            `;

            card.querySelector(`#comment-input-${video.id}`).addEventListener('focus', function() { showCommentActions(video.id); });
            card.querySelector(`#comment-input-${video.id}`).addEventListener('input', function() { autoResizeTextarea(this); });
            card.querySelector(`#comment-input-${video.id}`).addEventListener('keydown', function(e) { if (e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); postComment(video.id); } });
            return card;
        }

        function generateAvatar(name) { return name.charAt(0).toUpperCase(); }
        async function toggleVideoLike(videoId) {
            const csrfToken = document.getElementById('csrf_token').value;
            try {
                const response = await fetch(`${BASE_URL}/api/videos/${videoId}/like`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrfToken }
                });
                const data = await response.json();
                if (data.success) {
                    const likeBtn = document.getElementById(`like-btn-${videoId}`);
                    const likeCount = document.getElementById(`like-count-${videoId}`);
                    if (data.liked) { likeBtn.classList.add('liked'); } else { likeBtn.classList.remove('liked'); }
                    likeCount.textContent = data.likes_count;
                    videoLikes[videoId] = data.liked;
                } else { console.error('Failed to toggle like:', data.message); }
            } catch (error) { console.error('Error toggling like:', error); }
        }
        function toggleShareMenu(videoId) {
            const shareMenu = document.getElementById(`share-menu-${videoId}`);
            shareMenu.classList.toggle('active');
            document.addEventListener('click', function(e) {
                if (!e.target.closest('.share-menu')) { shareMenu.classList.remove('active'); }
            });
        }
        function copyToClipboard(url, title) {
            const linkToCopy = url;
            navigator.clipboard.writeText(linkToCopy).then(() => {
                const Toast = { show: (message) => { const toast = document.createElement('div'); toast.style.cssText = `position: fixed; top: 20px; right: 20px; background: #4CAF50; color: white; padding: 12px 24px; border-radius: 8px; z-index: 10000; font-size: 0.9rem;`; toast.textContent = message; document.body.appendChild(toast); setTimeout(() => { toast.remove(); }, 3000); } };
                Toast.show(`Link copied! "${title}"`);
            }).catch(() => {
                const textArea = document.createElement('textarea'); textArea.value = linkToCopy; document.body.appendChild(textArea); textArea.select(); document.execCommand('copy'); document.body.removeChild(textArea);
                const Toast = { show: (message) => { const toast = document.createElement('div'); toast.style.cssText = `position: fixed; top: 20px; right: 20px; background: #4CAF50; color: white; padding: 12px 24px; border-radius: 8px; z-index: 10000; font-size: 0.9rem;`; toast.textContent = message; document.body.appendChild(toast); setTimeout(() => { toast.remove(); }, 3000); } };
                Toast.show(`Link copied! "${title}"`);
            });
        }
        async function loadComments(videoId) {
            try {
                const response = await fetch(`${BASE_URL}/api/videos/${videoId}/comments`);
                const data = await response.json();
                if (data.success) { displayComments(videoId, data.comments); updateCommentCount(videoId, data.comments); }
                else { console.error('Failed to load comments:', data.message); }
            } catch (error) { console.error('Error loading comments:', error); }
        }
        function displayComments(videoId, comments) {
            const commentsList = document.getElementById(`comments-list-${videoId}`);
            if (comments.length === 0) { commentsList.innerHTML = `<div class="comments-empty"><div class="comments-empty-icon">💬</div><div class="comments-empty-text">No comments yet</div><div class="comments-empty-subtitle">Be the first to share your thoughts!</div></div>`; return; }
            commentsList.innerHTML = comments.map(comment => renderComment(comment, videoId)).join('');
        }
        function renderComment(comment, videoId) {
            const repliesHtml = comment.replies.map(reply => renderReply(reply, videoId)).join('');
            const canDelete = currentUser && (currentUser.id === comment.user_id || currentUser.is_admin);
            const deleteButton = canDelete ? `<button class="delete-comment-btn" onclick="deleteComment(${comment.id}, ${videoId})">Delete</button>` : '';
            return `
                <div class="comment">
                    <div class="comment-avatar">${generateAvatar(comment.author)}</div>
                    <div class="comment-content">
                        <div class="comment-header">
                            <div class="comment-author">${escapeHtml(comment.author)}</div>
                            <div class="comment-time">${comment.time}</div>
                        </div>
                        <div class="comment-text">${escapeHtml(comment.text)}</div>
                        <div class="comment-footer">
                            <button class="comment-like-btn ${comment.liked ? 'liked' : ''}" onclick="toggleCommentLike(${comment.id})"><span>❤️</span><span id="comment-like-count-${comment.id}">${comment.likes}</span></button>
                            <button class="comment-reply-btn" onclick="showReplyForm(${comment.id}, ${videoId})"><span>↩️</span>Reply</button>
                            ${deleteButton}
                        </div>
                        ${repliesHtml ? `<div class="replies">${repliesHtml}</div>` : ''}
                        <div class="reply-form" id="reply-form-${comment.id}" style="display: none;">
                            <textarea class="reply-input" id="reply-input-${comment.id}" placeholder="Write a reply..." rows="2"></textarea>
                            <div class="comment-actions">
                                <button class="cancel-btn" onclick="cancelReply(${comment.id})">Cancel</button>
                                <button class="comment-btn" onclick="postReply(${comment.id}, ${videoId})">Post</button>
                            </div>
                        </div>
                    </div>
                </div>
            `;
        }
        function renderReply(reply, videoId) {
            const canDelete = currentUser && (currentUser.id === reply.user_id || currentUser.is_admin);
            const deleteButton = canDelete ? `<button class="delete-comment-btn" onclick="deleteComment(${reply.id}, ${videoId})">Delete</button>` : '';
            return `
                <div class="reply">
                    <div class="comment-header">
                        <div class="comment-author">${escapeHtml(reply.author)}</div>
                        <div class="comment-time">${reply.time}</div>
                    </div>
                    <div class="comment-text">${escapeHtml(reply.text)}</div>
                    <div class="comment-footer">
                        <button class="comment-like-btn ${reply.liked ? 'liked' : ''}" onclick="toggleCommentLike(${reply.id})"><span>❤️</span><span id="comment-like-count-${reply.id}">${reply.likes}</span></button>
                        ${deleteButton}
                    </div>
                </div>
            `;
        }
        function updateCommentCount(videoId, comments) {
            const totalComments = comments.reduce((total, comment) => { return total + 1 + (comment.replies ? comment.replies.length : 0); }, 0);
            document.getElementById(`comment-count-${videoId}`).textContent = `${totalComments} ${totalComments === 1 ? 'comment' : 'comments'}`;
        }
        function toggleComments(videoId) {
            const commentsContainer = document.getElementById(`comments-${videoId}`);
            const toggleText = document.getElementById(`toggle-text-${videoId}`);
            if (commentsContainer.style.display === 'none' || commentsContainer.style.display === '') {
                commentsContainer.style.display = 'block'; toggleText.textContent = 'Hide Comments';
            } else { commentsContainer.style.display = 'none'; toggleText.textContent = 'Show Comments'; }
        }
        function showCommentActions(videoId) { document.getElementById(`comment-actions-${videoId}`).style.display = 'flex'; }
        function cancelComment(videoId) {
            const input = document.getElementById(`comment-input-${videoId}`);
            input.value = ''; input.style.height = 'auto'; document.getElementById(`comment-actions-${videoId}`).style.display = 'none'; input.blur();
        }
        async function postComment(videoId) {
            const input = document.getElementById(`comment-input-${videoId}`);
            const text = input.value.trim(); if (!text) return;
            const csrfToken = document.getElementById('csrf_token').value;
            try {
                const response = await fetch(`${BASE_URL}/api/videos/${videoId}/comments`, { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrfToken }, body: JSON.stringify({ text }) });
                const data = await response.json();
                if (data.success) { input.value = ''; input.style.height = 'auto'; cancelComment(videoId); loadComments(videoId); }
                else { console.error('Failed to post comment:', data.message); }
            } catch (error) { console.error('Error posting comment:', error); }
        }
        async function toggleCommentLike(commentId) {
            const csrfToken = document.getElementById('csrf_token').value;
            try {
                const response = await fetch(`${BASE_URL}/api/comments/${commentId}/like`, { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrfToken } });
                const data = await response.json();
                if (data.success) {
                    const likeBtn = document.querySelector(`[onclick="toggleCommentLike(${commentId})"]`);
                    if (data.liked) { likeBtn.classList.add('liked'); } else { likeBtn.classList.remove('liked'); }
                    document.getElementById(`comment-like-count-${commentId}`).textContent = data.likes_count;
                } else { console.error('Failed to toggle comment like:', data.message); }
            } catch (error) { console.error('Error toggling comment like:', error); }
        }
        function showReplyForm(commentId, videoId) {
            for (const id in activeReplyForms) { if (activeReplyForms[id] === videoId && id != commentId) { cancelReply(id); } }
            document.getElementById(`reply-form-${commentId}`).style.display = 'block';
            document.getElementById(`reply-input-${commentId}`).focus();
            activeReplyForms[commentId] = videoId;
        }
        function cancelReply(commentId) {
            document.getElementById(`reply-input-${commentId}`).value = '';
            document.getElementById(`reply-form-${commentId}`).style.display = 'none';
            delete activeReplyForms[commentId];
        }
        async function postReply(commentId, videoId) {
            const replyInput = document.getElementById(`reply-input-${commentId}`);
            const text = replyInput.value.trim(); if (!text) return;
            const csrfToken = document.getElementById('csrf_token').value;
            try {
                const response = await fetch(`${BASE_URL}/api/videos/${videoId}/comments`, { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrfToken }, body: JSON.stringify({ text, parent_id: commentId }) });
                const data = await response.json();
                if (data.success) { replyInput.value = ''; cancelReply(commentId); loadComments(videoId); }
                else { console.error('Failed to post reply:', data.message); }
            } catch (error) { console.error('Error posting reply:', error); }
        }
        function autoResizeTextarea(textarea) { textarea.style.height = 'auto'; textarea.style.height = textarea.scrollHeight + 'px'; }
        function escapeHtml(text) { const div = document.createElement('div'); div.textContent = text; return div.innerHTML; }
        function showError(message) {
            document.getElementById('loading').style.display = 'none';
            document.getElementById('video-feed').innerHTML = `<div class="error-message">${message}</div>`;
        }
        async function logout() {
            const csrfToken = document.getElementById('csrf_token').value;
            try {
                const response = await fetch(`${BASE_URL}/api/auth/logout`, { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrfToken } });
                const data = await response.json();
                if (data.success) { window.location.href = `${BASE_URL}/`; } else { console.error('Logout failed:', data.message); }
            } catch (error) { console.error('Error during logout:', error); window.location.href = `${BASE_URL}/`; }
        }
        document.addEventListener('click', function(e) {
            document.querySelectorAll('.share-dropdown').forEach(menu => { if (!e.target.closest('.share-menu') && menu.classList.contains('active')) { menu.classList.remove('active'); } });
            const likesModal = document.getElementById('likes-modal'); const commentsModal = document.getElementById('comments-modal'); const feedbackModal = document.getElementById('feedback-modal');
            if (likesModal.style.display === 'block' && !e.target.closest('.modal-content')) { closeLikesModal(); }
            if (commentsModal.style.display === 'block' && !e.target.closest('.modal-content')) { closeCommentsModal(); }
            if (feedbackModal.style.display === 'block' && !e.target.closest('.modal-content') && !e.target.closest('.feedback-button-container')) { closeFeedbackModal(); }
        });
        async function viewVideoComments(videoId) {
            const csrfToken = document.getElementById('csrf_token').value;
            try {
                document.getElementById('comments-content').innerHTML = `<div class="loading-small"><div class="loading-spinner"></div><div>Loading comments...</div></div>`;
                document.getElementById('comments-modal').style.display = 'block';
                const response = await fetch(`${BASE_URL}/api/admin/videos/${videoId}/comments`, { headers: { 'X-CSRFToken': csrfToken } });
                const data = await response.json();
                if (data.success) { displayCommentsModal(data.comments); }
                else { document.getElementById('comments-content').innerHTML = `<div class="empty-state-small"><div class="empty-icon">❌</div><div>Failed to load comments: ${escapeHtml(data.message || 'Unknown error')}</div></div>`; }
            } catch (error) { console.error('Error loading comments for modal:', error); document.getElementById('comments-content').innerHTML = `<div class="empty-state-small"><div class="empty-icon">❌</div><div>Failed to load comments due to a connection error.</div></div>`; }
        }
        function displayCommentsModal(comments) {
            const commentsContent = document.getElementById('comments-content');
            if (comments.length === 0) { commentsContent.innerHTML = `<div class="empty-state-small"><div class="empty-icon">💬</div><div>No comments yet</div><div style="margin-top: 5px; font-size: 0.8rem;">Be the first to comment!</div></div>`; return; }
            commentsContent.innerHTML = comments.map(comment => `
                <div class="comment-item">
                    <div class="user-info">
                        <div class="user-avatar">${generateAvatar(comment.author)}</div>
                        <div class="user-details">
                            <div class="user-name">${escapeHtml(comment.author)}</div>
                            <div class="user-email">${escapeHtml(comment.user_email)}</div> <div class="comment-text">${escapeHtml(comment.text)}</div>
                            <div class="comment-meta">
                                <span class="comment-time">${formatTimeAgo(comment.created_at)}</span>
                                <span class="comment-likes">❤️ ${comment.likes || 0}</span>
                                ${comment.replies && comment.replies.length > 0 ? `<span>💬 ${comment.replies.length} replies</span>` : ''}
                            </div>
                        </div>
                    </div>
                    ${currentUser && currentUser.is_admin ? `<button class="delete-comment-btn" onclick="deleteCommentFromModal(${comment.id})">Delete</button>` : ''}
                </div>
            `).join('');
        }
        async function deleteCommentFromModal(commentId) {
            if (!confirm('Are you sure you want to delete this comment? This action cannot be undone.')) { return; }
            const csrfToken = document.getElementById('csrf_token').value;
            try {
                const response = await fetch(`${BASE_URL}/api/comments/${commentId}`, { method: 'DELETE', headers: { 'X-CSRFToken': csrfToken } });
                const result = await response.json();
                if (result.success) {
                    const commentElement = document.querySelector(`[onclick="deleteCommentFromModal(${commentId})"]`).closest('.comment-item');
                    if (commentElement) { commentElement.remove(); }
                    videos.forEach(video => { if (document.getElementById(`comments-${video.id}`).style.display === 'block') { loadComments(video.id); } });
                } else { alert('Failed to delete comment: ' + (result.message || 'Unknown error')); }
            } catch (error) { console.error('Error deleting comment:', error); alert('Failed to delete comment. Please try again.'); }
        }
        async function deleteComment(commentId, videoId) {
            if (!confirm('Are you sure you want to delete this comment? This action cannot be undone.')) { return; }
            const csrfToken = document.getElementById('csrf_token').value;
            try {
                const response = await fetch(`${BASE_URL}/api/comments/${commentId}`, { method: 'DELETE', headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrfToken } });
                const result = await response.json();
                if (result.success) { loadComments(videoId); } else { alert('Failed to delete comment: ' + (result.message || 'Unknown error')); }
            } catch (error) { console.error('Error deleting comment:', error); alert('Failed to delete comment. Please try again.'); }
        }
        function closeCommentsModal() { document.getElementById('comments-modal').style.display = 'none'; }
        function closeLikesModal() { document.getElementById('likes-modal').style.display = 'none'; }
        function formatTimeAgo(dateString) {
            const date = new Date(dateString); const now = new Date(); const diff = now - date;
            const minutes = Math.floor(diff / 60000); const hours = Math.floor(diff / 3600000); const days = Math.floor(diff / 86400000);
            if (days > 0) { return `${days} day${days > 1 ? 's' : ''} ago`; } else if (hours > 0) { return `${hours} hour${hours > 1 ? 's' : ''} ago`; } else if (minutes > 0) { return `${minutes} minute${minutes > 1 ? 's' : ''} ago`; } else { return 'Just now'; }
        }
        function renderStoryItemHtml(video, type) {
            const youtubeShareUrl = `https://youtu.be/${video.youtube_video_id}`;
            let metaInfo = '';
            if (type === 'top-story') { metaInfo = `Likes: ${video.likes_count || 0}`; }
            else if (type === 'new-series' && video.genre) { metaInfo = `Genre: ${escapeHtml(video.genre)}`; }
            else { metaInfo = `Added: ${new Date(video.created_at).toLocaleDateString()}`; }
            return `
                <div class="story-item" onclick="window.open('${youtubeShareUrl}', '_blank');">
                    <div class="story-thumbnail"><img src="${video.thumbnail_url}" alt="${escapeHtml(video.title)}" onerror="this.src='https://placehold.co/80x45/1a1a1a/888?text=Video'"></div>
                    <div class="story-details">
                        <div class="story-title">${escapeHtml(video.title)}</div>
                        <div class="story-meta">${metaInfo}</div>
                    </div>
                </div>
            `;
        }

        // Renamed and adapted from loadTopStories and loadNewSeries
        async function loadCategorizedContent(sectionId, tag, title, emptyMessage) {
            const listElement = document.getElementById(sectionId);
            listElement.innerHTML = `
                <div class="story-item placeholder">
                    <div class="story-thumbnail"><img src="https://placehold.co/80x45/1a1a1a/888?text=Loading" alt="Loading"></div>
                    <div class="story-details">
                        <div class="story-title">Loading ${title}...</div>
                        <div class="story-meta"></div>
                    </div>
                </div>
            `;

            try {
                const response = await fetch(`${BASE_URL}/api/videos/categorized?tag=${encodeURIComponent(tag)}`);
                const data = await response.json();

                if (data.success && data.videos.length > 0) {
                    listElement.innerHTML = data.videos.map(video => renderStoryItemHtml(video, tag.toLowerCase().replace(' ', '-'))).join('');
                } else {
                    listElement.innerHTML = `
                        <div class="empty-state-small" style="padding: 10px 0;">
                            <div class="empty-icon" style="font-size: 1.5rem; margin-bottom: 5px;">${emptyMessage.icon}</div>
                            <div>${emptyMessage.text}</div>
                            <div style="font-size: 0.8rem; opacity: 0.7;">${emptyMessage.subtext}</div>
                        </div>
                    `;
                }
            } catch (error) {
                console.error(`Error loading ${title}:`, error);
                listElement.innerHTML = `<div class="empty-state-small" style="padding: 10px 0; color: #ff6b6b;"><div class="empty-icon" style="font-size: 1.5rem; margin-bottom: 5px;">❌</div>Failed to load ${title}.</div>`;
            }
        }

        async function loadPremiumSeries() {
            await loadCategorizedContent('premium-series-list', 'Premium Series', 'Premium Series', {
                icon: '🎬',
                text: 'No Premium Series yet.',
                subtext: 'Mark videos as "Premium Series" in admin to see them here.'
            });
        }

        async function loadShortsFeed() {
            await loadCategorizedContent('shorts-feed-list', 'Shorts', 'Shorts Feed', {
                icon: '⏱️',
                text: 'No Shorts yet.',
                subtext: 'Add short-form content and mark them as "Shorts" in admin.'
            });
        }

        async function loadChannels() {
            // For now, this is just a placeholder. True channel functionality would require distinct backend data.
            const channelsList = document.getElementById('channels-list');
            channelsList.innerHTML = `
                <div class="story-item placeholder">
                    <div class="story-thumbnail"><img src="https://placehold.co/80x45/1a1a1a/888?text=Creators" alt="Loading"></div>
                    <div class="story-details">
                        <div class="story-title">Loading Top Channels...</div>
                        <div class="story-meta">Explore diverse creators.</div>
                    </div>
                </div>
            `;
            // If you had a /api/channels endpoint, you would fetch and render them here.
            // Example: const response = await fetch(`${BASE_URL}/api/channels`);
            // This is primarily for visual representation of the concept.
        }

        function toggleBehindTheStory(videoId) {
            const contentDiv = document.getElementById(`behind-the-story-${videoId}`);
            if (contentDiv) {
                if (contentDiv.style.display === 'none' || contentDiv.style.display === '') {
                    contentDiv.style.display = 'block';
                } else {
                    contentDiv.style.display = 'none';
                }
            }
        }

        function showFeedbackModal() {
            document.getElementById('feedback-modal').style.display = 'flex';
            document.getElementById('feedback-text').value = '';
            document.getElementById('feedback-message').style.display = 'none';
            document.getElementById('feedback-message').className = 'feedback-success-message';
        }

        function closeFeedbackModal() {
            document.getElementById('feedback-modal').style.display = 'none';
        }

        async function submitFeedback() {
            const feedbackText = document.getElementById('feedback-text').value.trim();
            const feedbackMessageDiv = document.getElementById('feedback-message');
            const csrfToken = document.getElementById('csrf_token').value;

            if (!feedbackText) {
                feedbackMessageDiv.textContent = 'Feedback cannot be empty.';
                feedbackMessageDiv.className = 'feedback-error-message';
                feedbackMessageDiv.style.display = 'block';
                return;
            }

            feedbackMessageDiv.textContent = 'Sending feedback...';
            feedbackMessageDiv.className = 'feedback-success-message';
            feedbackMessageDiv.style.display = 'block';

            try {
                const response = await fetch(`${BASE_URL}/api/feedback`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrfToken },
                    body: JSON.stringify({ feedback: feedbackText })
                });
                const data = await response.json();
                if (response.ok) {
                    feedbackMessageDiv.textContent = 'Thank you for your feedback!';
                    feedbackMessageDiv.className = 'feedback-success-message';
                    document.getElementById('feedback-text').value = '';
                    setTimeout(() => closeFeedbackModal(), 2000);
                } else { throw new Error(data.message || 'Failed to send feedback.'); }
            } catch (error) {
                console.error('Error sending feedback:', error);
                feedbackMessageDiv.textContent = error.message || 'Error sending feedback. Please try again.';
                feedbackMessageDiv.className = 'feedback-error-message';
            }
        }

        async function updateDailyWatchStreak() {
            const streakCountElement = document.getElementById('streak-count');
            const csrfToken = document.getElementById('csrf_token').value;
            try {
                const getResponse = await fetch(`${BASE_URL}/api/user/watch-streak`, { method: 'GET', headers: { 'X-CSRFToken': csrfToken } });
                const getData = await getResponse.json();
                if (getData.success) {
                    streakCountElement.textContent = getData.streak;
                    const postResponse = await fetch(`${BASE_URL}/api/user/watch-streak`, { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-CSRFToken': csrfToken } });
                    const postData = await postResponse.json();
                    if (postData.success) {
                        streakCountElement.textContent = postData.streak;
                        console.log('Daily watch streak updated to:', postData.streak);
                    } else { console.warn('Failed to update streak:', postData.message); }
                } else { console.error('Failed to load streak:', getData.message); streakCountElement.textContent = 'N/A'; }
            } catch (error) { console.error('Error updating daily watch streak:', error); streakCountElement.textContent = 'N/A'; }
        }
    </script>
</body>
</html>
